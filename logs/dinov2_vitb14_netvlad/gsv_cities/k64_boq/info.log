2024-07-13 12:35:06   Arguments: Namespace(aggregation='netvlad', backbone='dinov2_vitb14', ca_method='gem', clusters=64, dataset_name='msls', datasets_folder='/root/autodl-tmp', efficient_ram_testing=False, epochs_num=40, features_dim=768, infer_batch_size=64, linear_dim=256, lr=6e-05, num_hiddens=3, num_preds_to_save=0, num_workers=16, patience=40, pca_dataset_folder='pitts30k/images/train', pca_dim=None, queries_name=None, recall_values=[1, 5, 10, 100], resize=[280, 280], resize_test_imgs=True, resume=None, save_dir='logs/dinov2_vitb14_netvlad/gsv_cities/2024-07-13_12-35-06', save_only_wrong_preds=False, seed=0, train_batch_size=160, trainable_layers='10,11', use_amp16=False, use_ca=False, use_cls=False, use_extra_datasets=False, use_linear=False, use_lora=False, val_positive_dist_threshold=25)
2024-07-13 12:35:06   The outputs are being saved in logs/dinov2_vitb14_netvlad/gsv_cities/2024-07-13_12-35-06
2024-07-13 12:35:06   Using 4 GPUs
2024-07-13 12:35:06   Val set: < BaseDataset, msls - #database: 18871; #queries: 740 >
2024-07-13 12:35:06   using MLP layer as FFN
2024-07-13 12:35:23   trainable params: 14277120 || all params: 86678784 || trainable%: 16.47
2024-07-13 12:35:23   module.backbone.model.blocks.10.norm1.weight, module.backbone.model.blocks.10.attn.q.weight, module.backbone.model.blocks.10.attn.k.weight, module.backbone.model.blocks.10.attn.v.weight, module.backbone.model.blocks.10.attn.proj.weight, module.backbone.model.blocks.10.ls1.gamma, module.backbone.model.blocks.10.norm2.weight, module.backbone.model.blocks.10.mlp.fc1.weight, module.backbone.model.blocks.10.mlp.fc2.weight, module.backbone.model.blocks.10.ls2.gamma, module.backbone.model.blocks.11.norm1.weight, module.backbone.model.blocks.11.attn.q.weight, module.backbone.model.blocks.11.attn.k.weight, module.backbone.model.blocks.11.attn.v.weight, module.backbone.model.blocks.11.attn.proj.weight, module.backbone.model.blocks.11.ls1.gamma, module.backbone.model.blocks.11.norm2.weight, module.backbone.model.blocks.11.mlp.fc1.weight, module.backbone.model.blocks.11.mlp.fc2.weight, module.backbone.model.blocks.11.ls2.gamma, module.aggregation.centroids, module.aggregation.conv.weight
2024-07-13 12:35:23   Start training epoch: 00
2024-07-13 12:41:07   Finished epoch 00 in 0:05:43, average epoch loss = 0.9099
2024-07-13 12:42:52   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 73.24, R@5: 83.38, R@10: 86.22, R@100: 94.86
2024-07-13 12:42:52   Improved: previous best R@1 = 0.0, current R@1 = 73.2
2024-07-13 12:42:52   Start training epoch: 01
2024-07-13 12:48:29   Finished epoch 01 in 0:05:35, average epoch loss = 0.5837
2024-07-13 12:50:59   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 81.62, R@5: 89.73, R@10: 92.30, R@100: 96.89
2024-07-13 12:50:59   Improved: previous best R@1 = 73.2, current R@1 = 81.6
2024-07-13 12:51:00   Start training epoch: 02
2024-07-13 12:56:38   Finished epoch 02 in 0:05:38, average epoch loss = 0.4536
2024-07-13 12:59:12   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 86.22, R@5: 93.11, R@10: 94.73, R@100: 97.84
2024-07-13 12:59:12   Improved: previous best R@1 = 81.6, current R@1 = 86.2
2024-07-13 12:59:13   Start training epoch: 03
2024-07-13 13:04:56   Finished epoch 03 in 0:05:40, average epoch loss = 0.3897
2024-07-13 13:07:30   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 88.92, R@5: 94.59, R@10: 95.95, R@100: 97.97
2024-07-13 13:07:30   Improved: previous best R@1 = 86.2, current R@1 = 88.9
2024-07-13 13:07:32   Start training epoch: 04
2024-07-13 13:13:08   Finished epoch 04 in 0:05:34, average epoch loss = 0.3460
2024-07-13 13:14:52   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 89.19, R@5: 95.27, R@10: 96.89, R@100: 98.38
2024-07-13 13:14:52   Improved: previous best R@1 = 88.9, current R@1 = 89.2
2024-07-13 13:14:53   Start training epoch: 05
2024-07-13 13:20:24   Finished epoch 05 in 0:05:30, average epoch loss = 0.3138
2024-07-13 13:22:09   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 90.81, R@5: 95.95, R@10: 96.62, R@100: 98.24
2024-07-13 13:22:09   Improved: previous best R@1 = 89.2, current R@1 = 90.8
2024-07-13 13:22:10   Start training epoch: 06
2024-07-13 13:27:40   Finished epoch 06 in 0:05:29, average epoch loss = 0.2964
2024-07-13 13:29:25   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 91.76, R@5: 96.08, R@10: 96.76, R@100: 98.24
2024-07-13 13:29:25   Improved: previous best R@1 = 90.8, current R@1 = 91.8
2024-07-13 13:29:26   Start training epoch: 07
2024-07-13 13:35:05   Finished epoch 07 in 0:05:38, average epoch loss = 0.2748
2024-07-13 13:36:51   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 91.62, R@5: 96.35, R@10: 97.03, R@100: 98.38
2024-07-13 13:36:51   Not improved: 1 / 40: best R@1 = 91.8, current R@1 = 91.6
2024-07-13 13:36:51   Start training epoch: 08
2024-07-13 13:42:22   Finished epoch 08 in 0:05:30, average epoch loss = 0.2561
2024-07-13 13:44:07   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.43, R@5: 96.62, R@10: 97.03, R@100: 98.78
2024-07-13 13:44:07   Improved: previous best R@1 = 91.8, current R@1 = 92.4
2024-07-13 13:44:08   Start training epoch: 09
2024-07-13 13:49:37   Finished epoch 09 in 0:05:28, average epoch loss = 0.2461
2024-07-13 13:51:23   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 91.89, R@5: 96.22, R@10: 97.30, R@100: 98.65
2024-07-13 13:51:23   Not improved: 1 / 40: best R@1 = 92.4, current R@1 = 91.9
2024-07-13 13:51:23   Start training epoch: 10
2024-07-13 13:56:56   Finished epoch 10 in 0:05:31, average epoch loss = 0.2336
2024-07-13 13:58:41   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.03, R@5: 96.62, R@10: 97.30, R@100: 98.65
2024-07-13 13:58:41   Not improved: 2 / 40: best R@1 = 92.4, current R@1 = 92.0
2024-07-13 13:58:41   Start training epoch: 11
2024-07-13 14:04:13   Finished epoch 11 in 0:05:30, average epoch loss = 0.2238
2024-07-13 14:05:58   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.57, R@5: 96.35, R@10: 97.16, R@100: 98.92
2024-07-13 14:05:58   Improved: previous best R@1 = 92.4, current R@1 = 92.6
2024-07-13 14:05:59   Start training epoch: 12
2024-07-13 14:11:30   Finished epoch 12 in 0:05:30, average epoch loss = 0.2112
2024-07-13 14:13:16   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.30, R@5: 96.35, R@10: 97.16, R@100: 98.92
2024-07-13 14:13:16   Not improved: 1 / 40: best R@1 = 92.6, current R@1 = 92.3
2024-07-13 14:13:16   Start training epoch: 13
2024-07-13 14:18:47   Finished epoch 13 in 0:05:30, average epoch loss = 0.2043
2024-07-13 14:20:33   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.57, R@5: 96.62, R@10: 97.16, R@100: 98.65
2024-07-13 14:20:33   Not improved: 2 / 40: best R@1 = 92.6, current R@1 = 92.6
2024-07-13 14:20:34   Start training epoch: 14
2024-07-13 14:26:06   Finished epoch 14 in 0:05:31, average epoch loss = 0.1986
2024-07-13 14:27:51   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.30, R@5: 96.62, R@10: 96.89, R@100: 98.78
2024-07-13 14:27:51   Not improved: 3 / 40: best R@1 = 92.6, current R@1 = 92.3
2024-07-13 14:27:52   Start training epoch: 15
2024-07-13 14:33:23   Finished epoch 15 in 0:05:30, average epoch loss = 0.1907
2024-07-13 14:35:09   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.70, R@5: 96.89, R@10: 97.03, R@100: 98.92
2024-07-13 14:35:09   Improved: previous best R@1 = 92.6, current R@1 = 92.7
2024-07-13 14:35:09   Start training epoch: 16
2024-07-13 14:40:43   Finished epoch 16 in 0:05:33, average epoch loss = 0.1883
2024-07-13 14:42:32   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.43, R@5: 96.62, R@10: 97.16, R@100: 98.65
2024-07-13 14:42:32   Not improved: 1 / 40: best R@1 = 92.7, current R@1 = 92.4
2024-07-13 14:42:32   Start training epoch: 17
2024-07-13 14:48:03   Finished epoch 17 in 0:05:29, average epoch loss = 0.1805
2024-07-13 14:50:11   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.16, R@5: 96.62, R@10: 97.16, R@100: 98.51
2024-07-13 14:50:11   Not improved: 2 / 40: best R@1 = 92.7, current R@1 = 92.2
2024-07-13 14:50:11   Start training epoch: 18
2024-07-13 14:55:46   Finished epoch 18 in 0:05:33, average epoch loss = 0.1771
2024-07-13 14:57:31   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 93.11, R@5: 96.62, R@10: 96.76, R@100: 98.78
2024-07-13 14:57:31   Improved: previous best R@1 = 92.7, current R@1 = 93.1
2024-07-13 14:57:32   Start training epoch: 19
2024-07-13 15:03:03   Finished epoch 19 in 0:05:29, average epoch loss = 0.1725
2024-07-13 15:04:48   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.57, R@5: 97.03, R@10: 97.16, R@100: 98.65
2024-07-13 15:04:48   Not improved: 1 / 40: best R@1 = 93.1, current R@1 = 92.6
2024-07-13 15:04:48   Start training epoch: 20
2024-07-13 15:10:20   Finished epoch 20 in 0:05:30, average epoch loss = 0.1677
2024-07-13 15:12:05   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.30, R@5: 96.76, R@10: 96.89, R@100: 98.78
2024-07-13 15:12:05   Not improved: 2 / 40: best R@1 = 93.1, current R@1 = 92.3
2024-07-13 15:12:05   Start training epoch: 21
2024-07-13 15:17:36   Finished epoch 21 in 0:05:30, average epoch loss = 0.1630
2024-07-13 15:19:22   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.03, R@5: 96.62, R@10: 97.03, R@100: 98.78
2024-07-13 15:19:22   Not improved: 3 / 40: best R@1 = 93.1, current R@1 = 92.0
2024-07-13 15:19:22   Start training epoch: 22
2024-07-13 15:24:53   Finished epoch 22 in 0:05:30, average epoch loss = 0.1591
2024-07-13 15:26:38   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.30, R@5: 96.76, R@10: 97.30, R@100: 98.92
2024-07-13 15:26:38   Not improved: 4 / 40: best R@1 = 93.1, current R@1 = 92.3
2024-07-13 15:26:39   Start training epoch: 23
2024-07-13 15:32:09   Finished epoch 23 in 0:05:29, average epoch loss = 0.1555
2024-07-13 15:33:54   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.97, R@5: 96.76, R@10: 97.16, R@100: 98.92
2024-07-13 15:33:54   Not improved: 5 / 40: best R@1 = 93.1, current R@1 = 93.0
2024-07-13 15:33:54   Start training epoch: 24
2024-07-13 15:39:26   Finished epoch 24 in 0:05:30, average epoch loss = 0.1529
2024-07-13 15:41:11   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.43, R@5: 96.62, R@10: 97.16, R@100: 98.92
2024-07-13 15:41:11   Not improved: 6 / 40: best R@1 = 93.1, current R@1 = 92.4
2024-07-13 15:41:12   Start training epoch: 25
2024-07-13 15:46:42   Finished epoch 25 in 0:05:29, average epoch loss = 0.1483
2024-07-13 15:48:28   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.30, R@5: 96.49, R@10: 96.89, R@100: 98.92
2024-07-13 15:48:28   Not improved: 7 / 40: best R@1 = 93.1, current R@1 = 92.3
2024-07-13 15:48:28   Start training epoch: 26
2024-07-13 15:53:58   Finished epoch 26 in 0:05:28, average epoch loss = 0.1475
2024-07-13 15:55:43   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 91.76, R@5: 96.49, R@10: 96.89, R@100: 98.78
2024-07-13 15:55:43   Not improved: 8 / 40: best R@1 = 93.1, current R@1 = 91.8
2024-07-13 15:55:44   Start training epoch: 27
2024-07-13 16:01:14   Finished epoch 27 in 0:05:29, average epoch loss = 0.1436
2024-07-13 16:03:00   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.43, R@5: 96.76, R@10: 97.30, R@100: 98.92
2024-07-13 16:03:00   Not improved: 9 / 40: best R@1 = 93.1, current R@1 = 92.4
2024-07-13 16:03:00   Start training epoch: 28
2024-07-13 16:08:30   Finished epoch 28 in 0:05:28, average epoch loss = 0.1401
2024-07-13 16:10:15   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.57, R@5: 97.03, R@10: 97.43, R@100: 98.78
2024-07-13 16:10:15   Not improved: 10 / 40: best R@1 = 93.1, current R@1 = 92.6
2024-07-13 16:10:15   Start training epoch: 29
2024-07-13 16:15:47   Finished epoch 29 in 0:05:31, average epoch loss = 0.1394
2024-07-13 16:17:33   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.84, R@5: 96.62, R@10: 97.03, R@100: 98.92
2024-07-13 16:17:33   Not improved: 11 / 40: best R@1 = 93.1, current R@1 = 92.8
2024-07-13 16:17:33   Start training epoch: 30
2024-07-13 16:23:04   Finished epoch 30 in 0:05:29, average epoch loss = 0.1349
2024-07-13 16:24:49   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.03, R@5: 96.62, R@10: 97.30, R@100: 98.92
2024-07-13 16:24:49   Not improved: 12 / 40: best R@1 = 93.1, current R@1 = 92.0
2024-07-13 16:24:49   Start training epoch: 31
2024-07-13 16:30:18   Finished epoch 31 in 0:05:28, average epoch loss = 0.1312
2024-07-13 16:32:04   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 91.89, R@5: 96.49, R@10: 96.89, R@100: 98.92
2024-07-13 16:32:04   Not improved: 13 / 40: best R@1 = 93.1, current R@1 = 91.9
2024-07-13 16:32:04   Start training epoch: 32
2024-07-13 16:37:36   Finished epoch 32 in 0:05:30, average epoch loss = 0.1311
2024-07-13 16:39:22   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.43, R@5: 96.49, R@10: 97.03, R@100: 98.78
2024-07-13 16:39:22   Not improved: 14 / 40: best R@1 = 93.1, current R@1 = 92.4
2024-07-13 16:39:22   Start training epoch: 33
2024-07-13 16:44:52   Finished epoch 33 in 0:05:29, average epoch loss = 0.1281
2024-07-13 16:46:37   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.03, R@5: 96.89, R@10: 97.16, R@100: 98.92
2024-07-13 16:46:37   Not improved: 15 / 40: best R@1 = 93.1, current R@1 = 92.0
2024-07-13 16:46:38   Start training epoch: 34
2024-07-13 16:52:07   Finished epoch 34 in 0:05:28, average epoch loss = 0.1255
2024-07-13 16:53:55   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.03, R@5: 96.76, R@10: 97.03, R@100: 98.92
2024-07-13 16:53:55   Not improved: 16 / 40: best R@1 = 93.1, current R@1 = 92.0
2024-07-13 16:53:55   Start training epoch: 35
2024-07-13 16:59:27   Finished epoch 35 in 0:05:30, average epoch loss = 0.1249
2024-07-13 17:01:12   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 91.49, R@5: 96.62, R@10: 96.89, R@100: 98.92
2024-07-13 17:01:12   Not improved: 17 / 40: best R@1 = 93.1, current R@1 = 91.5
2024-07-13 17:01:13   Start training epoch: 36
2024-07-13 17:06:43   Finished epoch 36 in 0:05:29, average epoch loss = 0.1217
2024-07-13 17:08:28   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.57, R@5: 96.76, R@10: 97.16, R@100: 98.92
2024-07-13 17:08:28   Not improved: 18 / 40: best R@1 = 93.1, current R@1 = 92.6
2024-07-13 17:08:29   Start training epoch: 37
2024-07-13 17:13:59   Finished epoch 37 in 0:05:29, average epoch loss = 0.1201
2024-07-13 17:15:45   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.84, R@5: 96.35, R@10: 97.30, R@100: 98.92
2024-07-13 17:15:45   Not improved: 19 / 40: best R@1 = 93.1, current R@1 = 92.8
2024-07-13 17:15:45   Start training epoch: 38
2024-07-13 17:21:18   Finished epoch 38 in 0:05:32, average epoch loss = 0.1182
2024-07-13 17:23:04   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 91.89, R@5: 96.62, R@10: 97.16, R@100: 98.51
2024-07-13 17:23:04   Not improved: 20 / 40: best R@1 = 93.1, current R@1 = 91.9
2024-07-13 17:23:04   Start training epoch: 39
2024-07-13 17:28:34   Finished epoch 39 in 0:05:29, average epoch loss = 0.1177
2024-07-13 17:30:20   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.84, R@5: 96.22, R@10: 97.16, R@100: 98.78
2024-07-13 17:30:20   Not improved: 21 / 40: best R@1 = 93.1, current R@1 = 92.8
2024-07-13 17:30:21   Best R@1: 93.1
2024-07-13 17:30:21   Trained for 40 epochs, in total in 4:55:14
2024-07-13 17:30:21   using MLP layer as FFN
2024-07-13 17:30:24   Test set: < BaseDataset, pitts30k - #database: 10000; #queries: 6816 >
2024-07-13 17:34:42   Recalls on < BaseDataset, pitts30k - #database: 10000; #queries: 6816 >: R@1: 93.38, R@5: 96.95, R@10: 98.05, R@100: 99.56
2024-07-13 17:34:42   Finished in 4:59:36
2024-07-13 17:34:43   Test set: < BaseDataset, sf_xl - #database: 8015; #queries: 7993 >
2024-07-13 17:38:33   Recalls on < BaseDataset, sf_xl - #database: 8015; #queries: 7993 >: R@1: 96.11, R@5: 98.47, R@10: 98.87, R@100: 99.65
2024-07-13 17:38:33   Finished in 5:03:27
