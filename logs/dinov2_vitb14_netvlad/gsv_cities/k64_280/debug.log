2024-07-12 14:12:29   Arguments: Namespace(aggregation='netvlad', backbone='dinov2_vitb14', ca_method='gem', clusters=64, dataset_name='msls', datasets_folder='/root/autodl-tmp', efficient_ram_testing=False, epochs_num=5, features_dim=768, infer_batch_size=64, linear_dim=256, lr=6e-05, num_hiddens=3, num_preds_to_save=0, num_workers=16, patience=10, pca_dataset_folder='pitts30k/images/train', pca_dim=None, queries_name=None, recall_values=[1, 5, 10, 100], resize=[280, 280], resize_test_imgs=True, resume=None, save_dir='logs/dinov2_vitb14_netvlad/gsv_cities/2024-07-12_14-12-29', save_only_wrong_preds=False, seed=0, train_batch_size=64, trainable_layers='8, 9, 10, 11', use_amp16=True, use_ca=False, use_cls=False, use_extra_datasets=False, use_linear=False, use_lora=False, val_positive_dist_threshold=25)
2024-07-12 14:12:29   The outputs are being saved in logs/dinov2_vitb14_netvlad/gsv_cities/2024-07-12_14-12-29
2024-07-12 14:12:29   Using 4 GPUs
2024-07-12 14:12:29   Loading gsv_cities and msls from folder /root/autodl-tmp
2024-07-12 14:12:30   Val set: < BaseDataset, msls - #database: 18871; #queries: 740 >
2024-07-12 14:12:30   using MLP layer as FFN
2024-07-12 14:12:32   Extracting features to initialize NetVLAD layer
2024-07-12 14:12:49   NetVLAD centroids shape: (64, 768)
2024-07-12 14:12:49   trainable params: 28455936 || all params: 86678784 || trainable%: 32.83
2024-07-12 14:12:49   module.backbone.model.blocks.8.norm1.weight, module.backbone.model.blocks.8.attn.q.weight, module.backbone.model.blocks.8.attn.k.weight, module.backbone.model.blocks.8.attn.v.weight, module.backbone.model.blocks.8.attn.proj.weight, module.backbone.model.blocks.8.ls1.gamma, module.backbone.model.blocks.8.norm2.weight, module.backbone.model.blocks.8.mlp.fc1.weight, module.backbone.model.blocks.8.mlp.fc2.weight, module.backbone.model.blocks.8.ls2.gamma, module.backbone.model.blocks.9.norm1.weight, module.backbone.model.blocks.9.attn.q.weight, module.backbone.model.blocks.9.attn.k.weight, module.backbone.model.blocks.9.attn.v.weight, module.backbone.model.blocks.9.attn.proj.weight, module.backbone.model.blocks.9.ls1.gamma, module.backbone.model.blocks.9.norm2.weight, module.backbone.model.blocks.9.mlp.fc1.weight, module.backbone.model.blocks.9.mlp.fc2.weight, module.backbone.model.blocks.9.ls2.gamma, module.backbone.model.blocks.10.norm1.weight, module.backbone.model.blocks.10.attn.q.weight, module.backbone.model.blocks.10.attn.k.weight, module.backbone.model.blocks.10.attn.v.weight, module.backbone.model.blocks.10.attn.proj.weight, module.backbone.model.blocks.10.ls1.gamma, module.backbone.model.blocks.10.norm2.weight, module.backbone.model.blocks.10.mlp.fc1.weight, module.backbone.model.blocks.10.mlp.fc2.weight, module.backbone.model.blocks.10.ls2.gamma, module.backbone.model.blocks.11.norm1.weight, module.backbone.model.blocks.11.attn.q.weight, module.backbone.model.blocks.11.attn.k.weight, module.backbone.model.blocks.11.attn.v.weight, module.backbone.model.blocks.11.attn.proj.weight, module.backbone.model.blocks.11.ls1.gamma, module.backbone.model.blocks.11.norm2.weight, module.backbone.model.blocks.11.mlp.fc1.weight, module.backbone.model.blocks.11.mlp.fc2.weight, module.backbone.model.blocks.11.ls2.gamma, module.aggregation.centroids, module.aggregation.conv.weight
2024-07-12 14:12:49   Start training epoch: 00
2024-07-12 14:18:08   Finished epoch 00 in 0:05:16, average epoch loss = 0.3937
2024-07-12 14:18:08   Extracting database features for evaluation/testing
2024-07-12 14:19:50   Extracting queries features for evaluation/testing
2024-07-12 14:20:02   Calculating recalls
2024-07-12 14:21:02   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 91.35, R@5: 95.95, R@10: 96.76, R@100: 98.65
2024-07-12 14:21:02   Improved: previous best R@1 = 0.0, current R@1 = 91.4
2024-07-12 14:21:02   Start training epoch: 01
2024-07-12 14:26:09   Finished epoch 01 in 0:05:06, average epoch loss = 0.2738
2024-07-12 14:26:09   Extracting database features for evaluation/testing
2024-07-12 14:27:47   Extracting queries features for evaluation/testing
2024-07-12 14:27:58   Calculating recalls
2024-07-12 14:28:56   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.30, R@5: 96.62, R@10: 97.03, R@100: 98.38
2024-07-12 14:28:56   Improved: previous best R@1 = 91.4, current R@1 = 92.3
2024-07-12 14:28:58   Start training epoch: 02
2024-07-12 14:34:06   Finished epoch 02 in 0:05:06, average epoch loss = 0.2340
2024-07-12 14:34:06   Extracting database features for evaluation/testing
2024-07-12 14:35:52   Extracting queries features for evaluation/testing
2024-07-12 14:36:04   Calculating recalls
2024-07-12 14:37:03   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.43, R@5: 97.03, R@10: 97.03, R@100: 98.78
2024-07-12 14:37:03   Improved: previous best R@1 = 92.3, current R@1 = 92.4
2024-07-12 14:37:05   Start training epoch: 03
2024-07-12 14:42:12   Finished epoch 03 in 0:05:06, average epoch loss = 0.2082
2024-07-12 14:42:12   Extracting database features for evaluation/testing
2024-07-12 14:43:57   Extracting queries features for evaluation/testing
2024-07-12 14:44:10   Calculating recalls
2024-07-12 14:45:08   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 92.03, R@5: 96.62, R@10: 96.89, R@100: 98.78
2024-07-12 14:45:08   Not improved: 1 / 10: best R@1 = 92.4, current R@1 = 92.0
2024-07-12 14:45:08   Start training epoch: 04
2024-07-12 14:50:18   Finished epoch 04 in 0:05:08, average epoch loss = 0.1909
2024-07-12 14:50:18   Extracting database features for evaluation/testing
2024-07-12 14:51:47   Extracting queries features for evaluation/testing
2024-07-12 14:51:59   Calculating recalls
2024-07-12 14:52:57   Recalls on val set < BaseDataset, msls - #database: 18871; #queries: 740 >: R@1: 91.89, R@5: 96.35, R@10: 97.03, R@100: 98.65
2024-07-12 14:52:57   Not improved: 2 / 10: best R@1 = 92.4, current R@1 = 91.9
2024-07-12 14:52:57   Best R@1: 92.4
2024-07-12 14:52:57   Trained for 05 epochs, in total in 0:40:28
2024-07-12 14:52:57   using MLP layer as FFN
2024-07-12 14:52:59   Test set: < BaseDataset, pitts30k - #database: 10000; #queries: 6816 >
2024-07-12 14:52:59   Extracting database features for evaluation/testing
2024-07-12 14:53:54   Extracting queries features for evaluation/testing
2024-07-12 14:54:35   Calculating recalls
2024-07-12 14:59:14   Recalls on < BaseDataset, pitts30k - #database: 10000; #queries: 6816 >: R@1: 93.59, R@5: 96.80, R@10: 97.83, R@100: 99.63
2024-07-12 14:59:14   Finished in 0:46:44
2024-07-12 14:59:14   Test set: < BaseDataset, sf_xl - #database: 8015; #queries: 7993 >
2024-07-12 14:59:14   Extracting database features for evaluation/testing
2024-07-12 15:00:02   Extracting queries features for evaluation/testing
2024-07-12 15:00:50   Calculating recalls
2024-07-12 15:05:12   Recalls on < BaseDataset, sf_xl - #database: 8015; #queries: 7993 >: R@1: 95.51, R@5: 98.29, R@10: 98.82, R@100: 99.67
2024-07-12 15:05:12   Finished in 0:52:42
